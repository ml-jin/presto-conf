# Hetu-core 调研文档

[TOC]

##  概述

openLooKeng 是一种引擎，它支持对任何数据、任何地方（包括地理上远程数据源）进行就位分析。它通过 SQL 2003 接口提供所有数据的全局视图。OpenLooKeng 具有高可用性、自动缩放、内置缓存和索引支持，可随时处理具有所需可靠性的企业工作负载。

openLooKeng 的目标是支持数据探索、临时查询和批处理，其近实时延迟范围从 100+ms 到分钟不等，而无需移动数据。openLooKeng 还支持分层部署，使地理上远程 openLooKeng 群集能够参与同一查询。借助跨区域查询计划优化功能，涉及远程数据的查询可以达到接近"本地"的性能

### 应用场景

#### 跨源异构查询方案
RDBMS（如 MySQL 和 Oracle）和 NoSQL（如 HBase、ES 和 Kafka）等数据管理系统被广泛用于客户的各种应用系统。随着数据量的增加和数据管理更好的改善，客户逐渐构建基于 Hive 或 MPPDB 的数据仓库。这些数据存储系统通常彼此隔离，从而形成独立的数据孤岛。数据分析师经常遇到以下问题：

由于不知道在何时何地使用所需的数据，您无法基于海量数据构建新的服务模型。
查询各种数据源需要不同的连接模式或客户端，并运行不同的 SQL 方言。这些差异会导致额外的学习成本和复杂的应用程序开发逻辑。
如果未聚合数据，则无法对不同系统的数据执行联合查询。
openLooKeng 可用于实现数据仓库（如 RDBMS、NoSQL、Hive 和 MPPDB）的联合查询。借助 openLooKeng 的跨源异构查询功能，数据分析师可以快速分析海量数据。

#### 跨域和跨 DC 查询
在两级或多级数据中心方案中，例如省市数据中心或总部分支数据中心，用户通常需要从省（总部）数据中心或市（分支）数据中心查询数据，跨域查询的瓶颈是多个数据中心之间的网络问题（如带宽不足、长时间延迟和数据包丢失）。因此，查询延迟时间长，性能不稳定。openLooKeng 是专为跨域查询而设计的跨域和跨 DC 解决方案。openLooKeng 群集部署在多个 DC 中。DC2 中 openLooKeng 群集完成计算后，结果通过网络传输到 DC1 中的 openLooKeng 群集，在 DC1 的 openLooKeng 群集中完成聚合计算。在跨域和跨直流 openLooKeng 解决方案中，计算结果在 openLooKeng 群集之间传输。这避免了网络带宽不足和数据包丢失引起的网络问题，并在一定程度上解决了跨域查询问题。

#### 分离存储和计算
openLooKeng 本身没有存储引擎，但它可以查询存储在不同数据源中的数据。因此，该系统是一个典型的存储与计算分离系统，可以轻松独立扩展计算和存储资源。openLooKeng 存储和计算分离体系结构适用于动态扩展群集，便于快速弹性扩展资源。

#### 快速数据探索
客户拥有大量数据。要使用数据，他们通常构建一个专用的数据仓库。但是，这会导致数据仓库维护和数据 ETL 时间成本的额外人工成本。对于需要快速浏览数据但不想构建专用数据仓库的客户，将数据复制并加载到数据仓库是费时费力的。openLooKeng 可以使用标准 SQL 定义虚拟数据集市，并使用跨源异构查询功能连接到每个数据源。这样，用户需要探索的各种分析任务可以在虚拟数据集市语义层定义。借助 openLooKeng 的数据虚拟化功能，客户可以基于各种数据源快速构建探索和分析服务，而无需构建复杂且专用的数据仓库。
### 关键特征
#### 交叉数据中心连接器
新的连接器直接连接到另一个 openLooKeng 群集，实现多个 DC 之间的协作。关键技术如下：

并行数据访问：同时访问数据源以提高访问效率。客户端可以同时从服务器获取数据以加速数据获取。
数据压缩：在数据传输过程中序列化之前，使用 GZIP 压缩算法对数据进行压缩，从而减少了通过网络传输的数据量。
跨 DC 动态筛选：筛选数据以减少从远程端拉出的数据量，确保网络稳定性并提高查询效率。
高可用性：在 openLooKeng 中，支持协调员 AA。因此，您可以使用代理（例如 Nginx）实现协调员之间的负载平衡，以实现高可用性。如果协调器有故障，则整个群集的可用性不受影响。
#### 动态过滤
在相关性较低的多表联接方案中，大多数探测侧行被筛选出来，因为它们在读取后与联接条件不匹配。因此，会导致不必要的联接计算、I/O 读取和网络传输。动态筛选根据联接条件和查询运行期间从生成端表读取的数据动态生成筛选条件，并应用筛选条件到探测端表的表扫描阶段。这减少了参与联接操作的探针表的数据量，有效地减少了网络传输，提高了 30% 的性能。
#### 索引
openLooKeng 通过对现有数据创建索引并存储在数据源外部的索引来提高查询效率。位图是记录二进制信息的位图索引。它适用于 AND 操作，可以使用字典快速查询。Bloom 使用位数组来表示一个集，该集可以快速确定一个值（仅支持等号）是否存在集。最小最大值记录文件中的最大和最小值，该值适用于大于或小于条件的语句。
#### 缓存
openLooKeng 创建多个缓存，如元数据缓存、执行计划缓存和 ORC 行数据缓存，以提高查询性能。
#### 元数据缓存
在第一次查询期间使用 JDBC 连接的所有连接器都缓存元数据，以提高查询性能。
#### ORC 行数据缓存
对于 ORC 文件，ORC 行数据缓存提供了一种缓存频繁访问的数据以提高查询延迟的高效方法。管理员能够在特定表和分区上创建缓存。
#### 执行计划缓存
执行计划在第一个查询后缓存，而不是在每次查询请求后丢弃，从而减少后续查询所需的预处理时间和资源。通过缓存这些计划，可以跳过耗时的计划生成步骤。
### 获取设计文档
单击此处获取设计文档。[文档](https://openlookeng.slite.com/p/channel/EDMAZKydV2MsM5trxJPmLv#)
### 下一步
[开发指南](https://gitee.com/openlookeng/hetu-core/blob/master/hetu-docs/en/develop/_index.md)
openLooKeng 基于 Trino（以前称为 PrestoSQL），并且是从 Trino 开源项目中分叉的。openLooKeng 具有其他优化和增强功能，可对任何数据（包括地理上远程数据源）进行就地分析。本指南面向 openLooKeng 贡献者和插件开发人员。
